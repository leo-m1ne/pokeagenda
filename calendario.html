<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<title>Calendario de Eventos</title>
<style>
:root{
  --bg:#f7f7f7;
  --primary:#6481b7;
  --muted:#6B6B76;
}

body{
  margin:0; padding:0 0 12px; font-family:Inter, system-ui, sans-serif; background:var(--bg); color:#111;
}
.page-header{
  display:flex;
  align-items:center;
  gap:8px;
  background:var(--primary);
  color:#e7e7e7;
  padding:16px;
  font-size:1.4rem;
  font-weight:700;
  border-radius:0;
  box-shadow:0 4px 12px rgba(10,10,20,0.1);
  position:sticky;
  top:0;
  left:0;
  z-index:10;
}
.back-arrow{
  background:none;
  border:none;
  font-size: 20px;
  font-weight: 900;
  color:#e7e7e7;
}

.back-arrow:hover{
  transform:translateX(-3px);
}
.calendar-box{
  background:#F6F6F6;
  border-radius:15px;
  padding:20px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  text-align:center;
  margin-bottom:12px;
}

.calendar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.calendar-header button{
  background:none;
  border:none;
  font-size:1.3rem;
  cursor:pointer;
  color:#6481b7;
}

.calendar-header h3{
  margin:0;
  font-weight:600;
}

.calendar-grid{
  display:grid;
  grid-template-columns: repeat(7, 1fr);
  gap:5px;
  font-size:0.9rem;
  color:#333;
}

.calendar-grid div{
  padding:10px 0;
  border-radius:10px;
  cursor:default;
  user-select:none;
  background:#F6F6F6;
}

.calendar-grid div:hover{ background:#e4e4ff; }
.calendar-grid .day-name{ 
  cursor:default; 
  pointer-events:none; 
  font-weight:600; 
  color:#555555; 
  background:#F6F6F6; 
}

.dates-section h4{
  color:#6481b7;
  margin:15px 0 10px;
  font-size:1.2rem;
}

.event{
  display:flex;
  align-items:center;
  background:#fff;
  border-radius:15px;
  padding:10px 15px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  cursor:pointer;
}

.event-date{
  display:flex;
  flex-direction: column;
  justify-content: center;
  background:#f2f2f2;
  border-radius:10px;
  padding:10px;
  text-align:center;
  margin-right:15px;
  min-width:50px;
}

.event-date .dateNum{
  color:#6481b7;
  font-size:1.5rem;
}

.event-info strong{ color:#6481b7; }

.modal{
  display:none;
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
  z-index:1000;
}

.modal-content{
  background:#fff;
  padding:20px;
  border-radius:10px;
  max-width:300px;
  width:90%;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.modal-content input, .modal-content textarea{
  width:100%;
  padding:6px;
  border:1px solid #ccc;
  border-radius:6px;
  box-sizing:border-box;
}

.modal-content button{
  margin-top:12px;
  padding:8px 12px;
  border:none;
  border-radius:6px;
  background:#6481b7;
  color:#fff;
  cursor:pointer;
}

.modal-content .secondary{
  background:#999;
}

.modal-content .danger{
  background:#c0392b;
}

.page-calendar{
  padding: 18px;
}
</style>
</head>
<body>

<header class="page-header">
  <button class="back-arrow" onclick="window.location.href='menu.html'">
    <i class="fa-solid fa-chevron-left"></i>
  </button>
  Calendario
</header>

<div class="page-calendar">
  <div class="calendar-box">
  <div class="calendar-header">
    <button id="prevMonth"><i class="fa-solid fa-chevron-left"></i></button>
    <h3 id="monthYear"></h3>
    <button id="nextMonth"><i class="fa-solid fa-chevron-right"></i></button>
  </div>
  <div class="calendar-grid" id="calendarDays"></div>
</div>

<div class="dates-section">
  <h4>Eventos próximos</h4>
  <div id="upcoming-events">Aún no has añadido ningún evento.</div>
</div>

<!-- Modal Agregar / Editar Evento -->
<div class="modal" id="event-modal">
  <div class="modal-content">
    <h3 id="modalDate"></h3>
    <input type="text" id="event-name" placeholder="Nombre del evento">
    <textarea id="event-desc" placeholder="Descripción (opcional)"></textarea>
    <input type="date" id="event-date">
    <button id="save-event">Guardar evento</button>
    <button id="delete-event" class="danger">Eliminar</button>
    <button id="close-event-modal" class="secondary">Cancelar</button>
  </div>
</div>

<!-- Modal Aviso -->
<div class="modal" id="info-modal">
  <div class="modal-content">
    <p id="info-message"></p>
    <button id="close-info" class="secondary">Cerrar</button>
  </div>
</div>

<!-- Modal Confirmar Eliminar -->
<div class="modal" id="confirm-modal">
  <div class="modal-content">
    <p>¿Seguro que deseas eliminar este evento?</p>
    <div style="display:flex; gap:8px; justify-content:flex-end;">
      <button id="confirm-yes" class="danger">Sí</button>
      <button id="confirm-no" class="secondary">No</button>
    </div>
  </div>
</div>

</div>



<script>
let events = JSON.parse(localStorage.getItem('events')) || [];
let selectedDate = null;
let editingIndex = null;
let currentDate = new Date();

const calendarDays = document.getElementById('calendarDays');
const monthYear = document.getElementById('monthYear');
const prevMonthBtn = document.getElementById('prevMonth');
const nextMonthBtn = document.getElementById('nextMonth');

const eventModal = document.getElementById('event-modal');
const modalDate = document.getElementById('modalDate');
const eventNameInput = document.getElementById('event-name');
const eventDescInput = document.getElementById('event-desc');
const eventDateInput = document.getElementById('event-date');
const saveEventBtn = document.getElementById('save-event');
const deleteEventBtn = document.getElementById('delete-event');
const closeEventModalBtn = document.getElementById('close-event-modal');

const infoModal = document.getElementById('info-modal');
const infoMessage = document.getElementById('info-message');
const closeInfoBtn = document.getElementById('close-info');

const confirmModal = document.getElementById('confirm-modal');
const confirmYesBtn = document.getElementById('confirm-yes');
const confirmNoBtn = document.getElementById('confirm-no');

const upcomingEl = document.getElementById('upcoming-events');

function generateCalendar(){
  calendarDays.innerHTML='';
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  monthYear.textContent = currentDate.toLocaleDateString('es-ES',{month:'long',year:'numeric'});

  const firstDay = new Date(year, month, 1).getDay() || 7;
  const daysInMonth = new Date(year, month+1, 0).getDate();

  const dayNames = ['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'];
  dayNames.forEach(d=>{
    const div = document.createElement('div');
    div.textContent=d;
    div.classList.add('day-name');
    calendarDays.appendChild(div);
  });

  for(let i=1;i<firstDay;i++) calendarDays.appendChild(document.createElement('div'));

  for(let d=1; d<=daysInMonth; d++){
    const dayEl = document.createElement('div');
    dayEl.textContent=d;
    const fullDate = new Date(year, month, d);
    dayEl.dataset.date = fullDate.toISOString().split('T')[0];

    dayEl.addEventListener('click', ()=>{
      const today = new Date(); today.setHours(0,0,0,0);
      if(fullDate < today){
        infoMessage.textContent = "No se pueden agregar eventos a fechas pasadas.";
        infoModal.style.display='flex';
        return;
      }
      selectedDate = fullDate;
      editingIndex = null;
      modalDate.textContent = selectedDate.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
      eventDateInput.value = selectedDate.toISOString().split('T')[0];
      eventNameInput.value = '';
      eventDescInput.value = '';
      deleteEventBtn.style.display = 'none';
      eventModal.style.display='flex';
    });

    calendarDays.appendChild(dayEl);
  }
}

function renderUpcomingEvents(){
  upcomingEl.innerHTML='';
  if(events.length===0){
    upcomingEl.textContent="Aún no has añadido ningún evento.";
    return;
  }
  const sorted = events.slice().sort((a,b)=> new Date(a.date)-new Date(b.date));
  sorted.forEach((ev,index)=>{
    const div = document.createElement('div');
    div.className='event';
    const d = new Date(ev.date);
    const name = ev.name || "Sin título";
    const desc = ev.desc ? ' - '+ev.desc : '';
    div.innerHTML=`<div class="event-date"><span class="dateNum"><strong>${d.getDate()}</strong></span><span>${d.toLocaleDateString('es-ES',{month:'short'})}</span></div>
    <div class="event-info"><strong>${name}</strong>${desc}</div>`;

    div.addEventListener('click', ()=>{
      selectedDate = new Date(ev.date);
      editingIndex = index;
      modalDate.textContent = selectedDate.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
      eventNameInput.value = ev.name;
      eventDescInput.value = ev.desc || '';
      eventDateInput.value = ev.date;
      deleteEventBtn.style.display = 'block';
      eventModal.style.display='flex';
    });

    upcomingEl.appendChild(div);
  });
}

saveEventBtn.addEventListener('click', ()=>{
  const name = eventNameInput.value.trim();
  const desc = eventDescInput.value.trim();
  const date = eventDateInput.value;
  if(!name || !date) return;

  if(editingIndex!==null){
    events[editingIndex] = {name,desc,date};
  }else{
    events.push({name,desc,date});
  }
  localStorage.setItem('events',JSON.stringify(events));
  renderUpcomingEvents();
  eventModal.style.display='none';
});

deleteEventBtn.addEventListener('click', ()=>{
  confirmModal.style.display='flex';
});

confirmYesBtn.addEventListener('click', ()=>{
  if(editingIndex!==null){
    events.splice(editingIndex,1);
    localStorage.setItem('events',JSON.stringify(events));
    renderUpcomingEvents();
    eventModal.style.display='none';
    confirmModal.style.display='none';
  }
});
confirmNoBtn.addEventListener('click', ()=>{confirmModal.style.display='none';});

closeEventModalBtn.addEventListener('click', ()=>{eventModal.style.display='none';});
closeInfoBtn.addEventListener('click', ()=>{infoModal.style.display='none';});

prevMonthBtn.addEventListener('click', ()=>{
  currentDate.setMonth(currentDate.getMonth()-1);
  generateCalendar();
});
nextMonthBtn.addEventListener('click', ()=>{
  currentDate.setMonth(currentDate.getMonth()+1);
  generateCalendar();
});

generateCalendar();
renderUpcomingEvents();
</script>
</body>
</html>
